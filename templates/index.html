<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Transporte</title>
    <script>
        function toggleFields() {
            const tipoProducto = document.getElementById('tipo_producto').value;
            const paletType = document.getElementById('palet_type');
            const height = document.getElementById('height');
            const category = document.getElementById('category');
            const sku = document.getElementById('sku');
            const modalidad = document.getElementById('modalidad');
            const numBultos = document.getElementById('num_bultos');

            if (tipoProducto === 'Normal') {
                paletType.disabled = false;
                height.disabled = false;
                category.disabled = true;
                sku.disabled = true;
                modalidad.disabled = true;
                numBultos.disabled = true;
            } else if (tipoProducto === 'XS') {
                paletType.disabled = true;
                height.disabled = true;
                category.disabled = false;
                sku.disabled = false;
                modalidad.disabled = false;
                numBultos.disabled = false;
            }
        }

        window.onload = toggleFields;
    </script>
</head>
<body>
    <h1>Calculadora de Transporte</h1>
    <form method="POST">

        <label for="tipo_producto">Tipo de Producto:</label>
        <select id="tipo_producto" name="tipo_producto" onchange="toggleFields()">
            <option value="Normal" {% if request.form.get('tipo_producto') == 'Normal' %}selected{% endif %}>Normal</option>
            <option value="XS" {% if request.form.get('tipo_producto') == 'XS' %}selected{% endif %}>XS</option>
        </select><br><br>

        <label for="palet_type">Tipo de Palet:</label>
        <select id="palet_type" name="palet_type">
            <option value="Medio Palet" {% if request.form.get('palet_type') == 'Medio Palet' %}selected{% endif %}>Medio Palet</option>
            <option value="Palet Completo" {% if request.form.get('palet_type') == 'Palet Completo' %}selected{% endif %}>Palet Completo</option>
        </select><br><br>

        <label for="height">Altura del Producto:</label>
        <select id="height" name="height">
            <option value="0.45" {% if request.form.get('height') == '0.45' %}selected{% endif %}>0.45</option>
            <option value="0.6" {% if request.form.get('height') == '0.6' %}selected{% endif %}>0.6</option>
            <option value="0.85" {% if request.form.get('height') == '0.85' %}selected{% endif %}>0.85</option>
            <option value="1.45" {% if request.form.get('height') == '1.45' %}selected{% endif %}>1.45</option>
            <option value="1.6" {% if request.form.get('height') == '1.6' %}selected{% endif %}>1.6</option>
            <option value="1.85" {% if request.form.get('height') == '1.85' %}selected{% endif %}>1.85</option>
            <option value="2.01" {% if request.form.get('height') == '2.01' %}selected{% endif %}>2.01</option>
        </select><br><br>

        <label for="province">Provincia de Destino:</label>
        <select id="province" name="province">
            {% for provincia in provincias_unificadas %}
                <option value="{{ provincia }}" {% if request.form.get('province') == provincia %}selected{% endif %}>{{ provincia }}</option>
            {% endfor %}
        </select><br><br>

        <label for="category">Categoría del Producto:</label>
        <select id="category" name="category" {% if request.form.get('tipo_producto') != 'XS' %}disabled{% endif %}>
            {% for categoria in categorias %}
                <option value="{{ categoria }}" {% if request.form.get('category') == categoria %}selected{% endif %}>{{ categoria }}</option>
            {% endfor %}
        </select><br><br>

        <label for="sku">SKU del Producto:</label>
        <select id="sku" name="sku" {% if request.form.get('tipo_producto') != 'XS' %}disabled{% endif %}>
            {% for sku in skus %}
                <option value="{{ sku }}" {% if request.form.get('sku') == sku %}selected{% endif %}>{{ sku }}</option>
            {% endfor %}
        </select><br><br>

        <label for="modalidad">Modalidad (horas):</label>
        <select name="modalidad" id="modalidad" {% if request.form.get('tipo_producto') != 'XS' %}disabled{% endif %}>
            <option value="24" {% if request.form.get('modalidad') == '24' %}selected{% endif %}>24 horas</option>
            <option value="48" {% if request.form.get('modalidad') == '48' %}selected{% endif %}>48 horas</option>
        </select><br><br>

        <label for="num_bultos">Número de Bultos:</label>
        <input type="number" name="num_bultos" id="num_bultos" value="{{ request.form.get('num_bultos') }}" {% if request.form.get('tipo_producto') != 'XS' %}disabled{% endif %}><br><br>

        <input type="submit" name="calcular" value="Calcular">
        <input type="submit" name="devolucion" value="Calcular Devolución">
    </form>

    {% if result %}
        <h2>Resultado</h2>
        <pre>{{ result }}</pre>
    {% endif %}
</body>
</html>
